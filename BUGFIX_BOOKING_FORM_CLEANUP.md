# üêõ Bug Fix: Booking Form - Lo·∫°i b·ªè th√¥ng tin ph√≤ng tr√πng l·∫∑p

**Ng√†y:** 16/10/2025  
**Tr·∫°ng th√°i:** ‚úÖ ƒê√£ s·ª≠a

---

## üìã V·∫•n ƒë·ªÅ

User b√°o c√°o: **"Sau khi b·∫•m ch·ªçn gi·ªù ƒë·∫∑t tr√™n b·∫£ng timeline th√¨ form ƒëƒÉng k√≠ ph√≤ng ko c√≤n m√¥ t·∫£ chi ti·∫øt ph√≤ng n·ªØa, ko c√≤n m·ª•c ti·ªán √≠ch lu√¥n"**

### Ph√¢n t√≠ch

Khi ki·ªÉm tra code, ph√°t hi·ªán:

1. **C·∫•u tr√∫c layout hi·ªán t·∫°i:**
   ```tsx
   // Khi showBookingForm = true
   <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
     <div className="lg:col-span-2">
       <BookingForm /> {/* C·ªôt tr√°i - chi·∫øm 2/3 */}
     </div>
     <div className="lg:col-span-1">
       <RoomDetailsPanel /> {/* C·ªôt ph·∫£i - chi·∫øm 1/3 */}
     </div>
   </div>
   ```

2. **V·∫•n ƒë·ªÅ ph√°t hi·ªán:**
   - `BookingForm` ƒëang hi·ªÉn th·ªã C√ôNG L√öC:
     - ‚úÖ Form ƒëƒÉng k√Ω (customer info, combo, menu)
     - ‚ùå H√¨nh ·∫£nh ph√≤ng (slideshow)
     - ‚ùå M√¥ t·∫£ ph√≤ng
     - ‚ùå Ti·ªán √≠ch ph√≤ng
   
   - `RoomDetailsPanel` (c·ªôt b√™n ph·∫£i) C≈®NG hi·ªÉn th·ªã:
     - ‚úÖ H√¨nh ·∫£nh ph√≤ng
     - ‚úÖ M√¥ t·∫£ ph√≤ng
     - ‚úÖ Ti·ªán √≠ch ph√≤ng

3. **Nguy√™n nh√¢n:**
   - Th√¥ng tin ph√≤ng b·ªã **TR√ôNG L·∫∂P** gi·ªØa BookingForm v√† RoomDetailsPanel
   - BookingForm qu√° d√†i ‚Üí ƒë·∫©y RoomDetailsPanel xu·ªëng d∆∞·ªõi (tr√™n mobile)
   - User kh√¥ng nh√¨n th·∫•y RoomDetailsPanel do b·ªã che khu·∫•t b·ªüi BookingForm

---

## ‚úÖ Gi·∫£i ph√°p

### T√°ch bi·ªát tr√°ch nhi·ªám components:

**`BookingForm`:**
- ‚úÖ GI·ªÆ L·∫†I slideshow h√¨nh ·∫£nh ph√≤ng
- ‚ùå X√ìA m√¥ t·∫£ ph√≤ng
- ‚ùå X√ìA ti·ªán √≠ch ph√≤ng
- CH·ªà ch·ª©a: H√¨nh ·∫£nh + Form ƒëƒÉng k√Ω
- Hi·ªÉn th·ªã **FULL WIDTH** khi ƒë∆∞·ª£c m·ªü

**`RoomDetailsPanel`:**
- Hi·ªÉn th·ªã ƒë·∫ßy ƒë·ªß th√¥ng tin ph√≤ng (h√¨nh ·∫£nh, m√¥ t·∫£, ti·ªán √≠ch)
- CH·ªà hi·ªÉn th·ªã khi ch∆∞a b·∫•m ch·ªçn gi·ªù (timeline view)
- B·ªä ·∫®N khi ƒë√£ b·∫•m ch·ªçn gi·ªù (form view)

### C√°c thay ƒë·ªïi th·ª±c hi·ªán:

#### 1. ·∫®n RoomDetailsPanel khi hi·ªÉn th·ªã BookingForm

**TR∆Ø·ªöC:**
```tsx
// Khi showBookingForm = true
<div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
  <div className="lg:col-span-2">
    <BookingForm ... />
  </div>
  <div className="lg:col-span-1">
    <RoomDetailsPanel room={room} /> {/* ‚ùå V·∫´n hi·ªÉn th·ªã */}
  </div>
</div>
```

**SAU:**
```tsx
// Khi showBookingForm = true
<div className="max-w-4xl mx-auto">
  <BookingForm ... /> {/* ‚úÖ Full width, kh√¥ng c√≥ RoomDetailsPanel */}
</div>
```

#### 2. X√≥a ph·∫ßn hi·ªÉn th·ªã h√¨nh ·∫£nh ph√≤ng trong BookingForm

**TR∆Ø·ªöC:**
```tsx
<div className="space-y-3">
  <Label className="text-base font-semibold text-gray-800">H√¨nh ·∫£nh ph√≤ng</Label>
  <div className="relative aspect-video rounded-lg overflow-hidden bg-gray-100 border-2 border-pink-200">
    <img src={roomImages[currentImageIndex]} ... />
    {/* Slideshow controls */}
  </div>
</div>
```

**SAU:**
```tsx
// ‚ùå ƒê√£ x√≥a to√†n b·ªô
```

#### 2. X√≥a ph·∫ßn hi·ªÉn th·ªã h√¨nh ·∫£nh ph√≤ng trong BookingForm

**TR∆Ø·ªöC:**
```tsx
<div className="space-y-3">
  <Label className="text-base font-semibold text-gray-800">H√¨nh ·∫£nh ph√≤ng</Label>
  <div className="relative aspect-video rounded-lg overflow-hidden bg-gray-100 border-2 border-pink-200">
    <img src={roomImages[currentImageIndex]} ... />
    {/* Slideshow controls */}
  </div>
</div>
```

**SAU:**
```tsx
// ‚úÖ GI·ªÆ L·∫†I - H√¨nh ·∫£nh slideshow v·∫´n hi·ªÉn th·ªã trong BookingForm
<div className="space-y-3">
  <Label className="text-base font-semibold text-gray-800">H√¨nh ·∫£nh ph√≤ng</Label>
  <div className="relative aspect-video rounded-lg overflow-hidden bg-gray-100 border-2 border-pink-200">
    <img src={roomImages[currentImageIndex]} ... />
    {/* Slideshow controls v·ªõi prev/next buttons */}
  </div>
</div>
```

#### 3. X√≥a ph·∫ßn m√¥ t·∫£ ph√≤ng trong BookingForm

**TR∆Ø·ªöC:**
```tsx
{room.description && (
  <div className="space-y-2 p-4 bg-gradient-to-r from-pink-50 to-purple-50 rounded-lg border border-pink-200">
    <Label className="text-base font-semibold text-gray-800">M√¥ t·∫£ ph√≤ng</Label>
    <p className="text-sm text-gray-700 leading-relaxed">{room.description}</p>
  </div>
)}
```

**SAU:**
```tsx
// ‚ùå ƒê√£ x√≥a to√†n b·ªô
```

#### 3. X√≥a ph·∫ßn m√¥ t·∫£ ph√≤ng trong BookingForm

**TR∆Ø·ªöC:**
```tsx
{room.description && (
  <div className="space-y-2 p-4 bg-gradient-to-r from-pink-50 to-purple-50 rounded-lg border border-pink-200">
    <Label className="text-base font-semibold text-gray-800">M√¥ t·∫£ ph√≤ng</Label>
    <p className="text-sm text-gray-700 leading-relaxed">{room.description}</p>
  </div>
)}
```

**SAU:**
```tsx
// ‚ùå ƒê√£ x√≥a to√†n b·ªô
```

#### 4. X√≥a ph·∫ßn ti·ªán √≠ch ph√≤ng trong BookingForm

**TR∆Ø·ªöC:**
```tsx
<div className="space-y-3">
  <Label className="text-base font-semibold text-gray-800">Ti·ªán √≠ch ph√≤ng</Label>
  <div className="grid grid-cols-1 md:grid-cols-2 gap-2">
    {room.amenities.map((amenity, index) => (
      <div key={index} className="flex items-center gap-2 p-2 rounded-lg bg-pink-50 border border-pink-200">
        <Check className="h-3 w-3 text-white" />
        <span className="text-sm text-gray-700">{amenity}</span>
      </div>
    ))}
  </div>
</div>
```

**SAU:**
```tsx
// ‚ùå ƒê√£ x√≥a to√†n b·ªô
```

#### 4. X√≥a ph·∫ßn ti·ªán √≠ch ph√≤ng trong BookingForm

**TR∆Ø·ªöC:**
```tsx
<div className="space-y-3">
  <Label className="text-base font-semibold text-gray-800">Ti·ªán √≠ch ph√≤ng</Label>
  <div className="grid grid-cols-1 md:grid-cols-2 gap-2">
    {room.amenities.map((amenity, index) => (
      <div key={index} className="flex items-center gap-2 p-2 rounded-lg bg-pink-50 border border-pink-200">
        <Check className="h-3 w-3 text-white" />
        <span className="text-sm text-gray-700">{amenity}</span>
      </div>
    ))}
  </div>
</div>
```

**SAU:**
```tsx
// ‚ùå ƒê√£ x√≥a to√†n b·ªô
```

#### 5. Cleanup code kh√¥ng d√πng

**State KH√îNG x√≥a (v·∫´n d√πng cho slideshow):**
```tsx
const [currentImageIndex, setCurrentImageIndex] = useState(0)
const roomImages = room.images || []
```

**Functions KH√îNG x√≥a (v·∫´n d√πng cho slideshow):**
```tsx
const nextImage = () => { ... }
const prevImage = () => { ... }
```

**Imports KH√îNG x√≥a (v·∫´n d√πng cho slideshow buttons):**
```tsx
- ChevronLeft ‚úÖ
- ChevronRight ‚úÖ
```

---

## üìä K·∫øt qu·∫£

### BookingForm sau khi cleanup:

```tsx
<Card className="border-2 border-pink-200 max-w-4xl mx-auto">
  <CardHeader>
    <CardTitle>ƒê·∫∑t ph√≤ng Cinema - {room.name}</CardTitle>
  </CardHeader>
  <form onSubmit={handleSubmit}>
    <CardContent className="space-y-6 pt-6">
      {/* 1. Slideshow h√¨nh ·∫£nh ph√≤ng - ‚úÖ GI·ªÆ L·∫†I */}
      <div className="space-y-3">
        <Label>H√¨nh ·∫£nh ph√≤ng</Label>
        <div className="relative aspect-video rounded-lg overflow-hidden">
          <img src={roomImages[currentImageIndex]} ... />
          {/* Prev/Next buttons v√† dots indicator */}
        </div>
      </div>

      {/* 2. Ch·ªçn g√≥i combo */}
      <div className="space-y-3">
        <Label>Ch·ªçn g√≥i combo</Label>
        {/* Combo buttons */}
      </div>

      {/* 3. Ch·ªçn ng√†y/gi·ªù (n·∫øu kh√¥ng ch·ªçn combo) */}
      {!selectedCombo && (
        <>
          <div className="space-y-2">
            <Label>Ng√†y ƒë·∫∑t</Label>
            <Calendar ... />
          </div>
          <div className="grid grid-cols-2 gap-4">
            <div className="space-y-2">
              <Label>Gi·ªù b·∫Øt ƒë·∫ßu</Label>
              <Input type="time" ... />
            </div>
            <div className="space-y-2">
              <Label>Gi·ªù k·∫øt th√∫c</Label>
              <Input type="time" ... />
            </div>
          </div>
        </>
      )}

      {/* 3. Th√¥ng tin kh√°ch h√†ng */}
      <div className="space-y-4 pt-4 border-t-2 border-pink-200">
        <Label>Th√¥ng tin kh√°ch h√†ng</Label>
        <Input placeholder="H·ªç v√† t√™n" ... />
        <Input placeholder="S·ªë ƒëi·ªán tho·∫°i" ... />
      </div>

      {/* 4. Ch·ªçn menu items */}
      <div className="space-y-3">
        <Label>ƒê·ªì ƒÉn & n∆∞·ªõc u·ªëng</Label>
        {/* Menu items */}
      </div>

      {/* 5. T·ªïng ti·ªÅn */}
      <div className="p-4 bg-gradient-to-r from-pink-50 to-purple-50 rounded-lg border-2 border-pink-200">
        <div className="flex justify-between items-center">
          <span className="font-bold text-lg text-gray-800">T·ªïng c·ªông:</span>
          <span className="font-bold text-2xl text-pink-600">
            {calculateTotal().toLocaleString("vi-VN")}ƒë
          </span>
        </div>
      </div>
    </CardContent>

    {/* 6. Action buttons */}
    <CardFooter className="flex gap-4">
      <Button type="button" variant="outline" onClick={onCancel}>
        H·ªßy
      </Button>
      <Button type="submit" disabled={isSubmitting}>
        {isSubmitting ? "ƒêang x·ª≠ l√Ω..." : "X√°c nh·∫≠n ƒë·∫∑t ph√≤ng"}
      </Button>
    </CardFooter>
  </form>
</Card>
```

### RoomDetailsPanel v·∫´n gi·ªØ nguy√™n:

```tsx
<div className="lg:col-span-1">
  <RoomDetailsPanel room={room} />
  {/* 
    - H√¨nh ·∫£nh ph√≤ng slideshow
    - M√¥ t·∫£ ph√≤ng
    - Ti·ªán √≠ch ph√≤ng
  */}
</div>
```

---

## üéØ L·ª£i √≠ch

‚úÖ **GI·ªÆ L·∫†I slideshow h√¨nh ·∫£nh** - User v·∫´n th·∫•y ƒë∆∞·ª£c ph√≤ng nh∆∞ th·∫ø n√†o khi ƒëi·ªÅn form  
‚úÖ **X√ìA m√¥ t·∫£ v√† ti·ªán √≠ch** - Gi·∫£m ƒë·ªô d√†i form, t·∫≠p trung v√†o ƒëƒÉng k√Ω  
‚úÖ **BookingForm g·ªçn g√†ng h∆°n** - ch·ªâ t·∫≠p trung v√†o h√¨nh ·∫£nh + form ƒëƒÉng k√Ω  
‚úÖ **RoomDetailsPanel CH·ªà hi·ªÉn th·ªã khi c·∫ßn** - ·ªü timeline view  
‚úÖ **BookingForm full width** - d·ªÖ nh√¨n v√† ƒëi·ªÅn form h∆°n  
‚úÖ **UX t·ªët h∆°n** - kh√¥ng b·ªã ph√¢n t√¢m b·ªüi qu√° nhi·ªÅu th√¥ng tin khi ƒëang ƒëi·ªÅn form  
‚úÖ **Code s·∫°ch h∆°n** - x√≥a b·ªè m√¥ t·∫£ v√† ti·ªán √≠ch tr√πng l·∫∑p  
‚úÖ **Layout ƒë∆°n gi·∫£n h∆°n** - kh√¥ng c√≥ c·ªôt ph·ª• khi ƒëi·ªÅn form

---

## üìù Files thay ƒë·ªïi

- ‚úÖ `components/booking-form.tsx` - X√≥a b·ªè ph·∫ßn hi·ªÉn th·ªã th√¥ng tin ph√≤ng
- ‚úÖ `app/booking/[roomId]/page.tsx` - ·∫®n RoomDetailsPanel khi hi·ªÉn th·ªã BookingForm

---

## üß™ Testing

### Test cases:

1. ‚úÖ **Tr∆∞·ªõc khi ch·ªçn gi·ªù:**
   - Hi·ªÉn th·ªã Timeline (2/3) + RoomDetailsPanel (1/3)
   - RoomDetailsPanel hi·ªÉn th·ªã ƒë·∫ßy ƒë·ªß: h√¨nh ·∫£nh, m√¥ t·∫£, ti·ªán √≠ch

2. ‚úÖ **Sau khi ch·ªçn gi·ªù:**
   - CH·ªà hi·ªÉn th·ªã BookingForm (full width, max-width: 4xl, centered)
   - KH√îNG hi·ªÉn th·ªã RoomDetailsPanel
   - BookingForm ch·ª©a: ‚úÖ Slideshow h√¨nh ·∫£nh + ‚ùå M√¥ t·∫£ ph√≤ng + ‚ùå Ti·ªán √≠ch ph√≤ng
   - BookingForm CH·ªà ch·ª©a: H√¨nh ·∫£nh slideshow + form ƒëƒÉng k√Ω + ch·ªçn combo + menu + t·ªïng ti·ªÅn

3. ‚úÖ **Khi b·∫•m n√∫t "H·ªßy" trong BookingForm:**
   - Quay l·∫°i timeline view
   - RoomDetailsPanel xu·∫•t hi·ªán tr·ªü l·∫°i

4. ‚úÖ **Responsive:**
   - Desktop: Timeline view c√≥ 2 c·ªôt, Form view full width
   - Mobile: C·∫£ 2 view ƒë·ªÅu full width

---

## ‚ú® T√≥m t·∫Øt

**V·∫•n ƒë·ªÅ ban ƒë·∫ßu:** Th√¥ng tin ph√≤ng b·ªã tr√πng l·∫∑p gi·ªØa BookingForm v√† RoomDetailsPanel  
**V·∫•n ƒë·ªÅ th·ª© 2:** RoomDetailsPanel v·∫´n hi·ªÉn th·ªã d∆∞ th·ª´a khi ƒë√£ b·∫•m ch·ªçn gi·ªù  

**Gi·∫£i ph√°p:**  
1. ‚úÖ GI·ªÆ L·∫†I slideshow h√¨nh ·∫£nh trong BookingForm (user c·∫ßn xem ph√≤ng)
2. ‚ùå X√ìA m√¥ t·∫£ v√† ti·ªán √≠ch kh·ªèi BookingForm (gi·∫£m ƒë·ªô d√†i form)
3. ‚ùå ·∫®N RoomDetailsPanel khi hi·ªÉn th·ªã BookingForm
4. ‚úÖ BookingForm hi·ªÉn th·ªã full width khi ƒë∆∞·ª£c m·ªü

**K·∫øt qu·∫£:**  
- UX t·ªët h∆°n: V·ª´a xem ƒë∆∞·ª£c ph√≤ng, v·ª´a t·∫≠p trung v√†o form ƒëƒÉng k√Ω
- Code s·∫°ch h∆°n: X√≥a b·ªè m√¥ t·∫£ v√† ti·ªán √≠ch tr√πng l·∫∑p
- Layout ƒë∆°n gi·∫£n h∆°n: Kh√¥ng c√≥ c·ªôt ph·ª• g√¢y r·ªëi m·∫Øt
- Form v·ª´a ƒë·ªß: H√¨nh ·∫£nh + th√¥ng tin ƒëƒÉng k√Ω, kh√¥ng qu√° d√†i
